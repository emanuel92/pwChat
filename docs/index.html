<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>WebRTC Video Chat</title>
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <meta name="theme-color" content="#ffffff" />
    <link href="css/fontawesome.min.css" rel="stylesheet" />
    <link href="css/solid.min.css" rel="stylesheet" />
    <link href="css/style.css" rel="stylesheet" />
    <link rel="manifest" href="manifest.webmanifest" />
  </head>
  <body>
    <div id="networkStatus">
      Connection Error <br>
      Sorry, but you are currently offline and can't make a call right now. <br>
      Waiting for reconnection ...
    </div>

    <div class="center">
      <div class="button_row">
      <button id="sendOfferButton" onclick="createAndSendOffer()">
        <i class="fas fa-phone-volume"></i><br>Call</button>
      <button id="answerButton" onclick="createAndSendAnswer()">
        <i class="fas fa-phone-volume"></i><br>Answer</button>
      <button id="hangUpButton" onclick="disconnectRTCPeerConnection()">
        <i class="fas fa-phone-slash"></i><br>Hang Up</button>
      </div>
        
        <br /><br />

      <input
        id="messageInput"
        type="text"
        size="80"
        placeholder="Enter message to send"
      />
      <button id="sendMessageButton" onclick="sendMessage()">
        Send Message</button
      ><br /><br />

      <p style="text-align: center">Tap to Change Front/Back Camera</p>

      <div id="videoContainer">
        <video
          id="localVideo"
          onclick="switchMobileCamera()"
          muted
          autoplay
          playsinline
        ></video>
        <video id="remoteVideo" autoplay playsinline></video>
      </div>
      <br /><br />

      <textarea readonly id="chatTextArea"></textarea><br /><br />

      <textarea readonly id="logs"></textarea>
    </div>
    <script>
      //ServiceWorker
      console.log("registerServiceWorker.js started");

      if ("serviceWorker" in navigator) {
        navigator.serviceWorker.register("sw.js", {
          scope: "/pwChat/"
        });

        //navigator.serviceWorker.ready always resolve
        navigator.serviceWorker.ready.then(function(registration) {
          console.log(
            "Service worker successfully registered on scope",
            registration.scope
          );
        });
      }

      let networkStatus = document.getElementById("networkStatus")
      window.addEventListener("load", () => {
        function handleNetworkChange(event) {
          if (navigator.onLine) {
            networkStatus.classList.remove("offline");
            connectToWebSocket();
          } else {
            networkStatus.classList.add("offline");
          }
        }
        window.addEventListener("online", handleNetworkChange);
        window.addEventListener("offline", handleNetworkChange);
      });
    </script>
    <script src="index.js"></script>
  </body>
</html>
